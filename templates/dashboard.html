<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adolescent Concern Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-gradient-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line"></i> Adolescent Health Analytics
            </a>
        </div>
    </nav>

    <div class="container-fluid px-3 px-md-5">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="display-4 text-center mb-2">
                <i class="fas fa-heartbeat text-danger"></i> 
                Adolescent Concern Analysis Dashboard
            </h1>
            <p class="lead text-center text-muted mb-4">
                Understanding the impact of unhealthy food advertising on adolescent health concerns
            </p>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="stat-card">
                    <div class="stat-icon bg-primary">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-content">
                        <h3>{{ total_records }}</h3>
                        <p>Total Records</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stat-card">
                    <div class="stat-icon bg-success">
                        <i class="fas fa-smile"></i>
                    </div>
                    <div class="stat-content">
                        <h3>{{ concern_distribution.get(1, 0) }}</h3>
                        <p>Low Concern</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stat-card">
                    <div class="stat-icon bg-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <h3>{{ concern_distribution.get(0, 0) }}</h3>
                        <p>High Concern</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-gradient-primary text-white">
                <h5 class="mb-0"><i class="fas fa-filter"></i> Data Filters</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="age_min" class="form-label">
                                <i class="fas fa-calendar-minus"></i> Minimum Age
                            </label>
                            <input type="number" id="age_min" name="age_min" value="{{ age_min }}" 
                                   min="13" max="18" class="form-control">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="age_max" class="form-label">
                                <i class="fas fa-calendar-plus"></i> Maximum Age
                            </label>
                            <input type="number" id="age_max" name="age_max" value="{{ age_max }}" 
                                   min="13" max="18" class="form-control">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="gender" class="form-label">
                                <i class="fas fa-users"></i> Gender
                            </label>
                            <select id="gender" name="gender" class="form-control">
                                <option value="All" {% if gender == 'All' %}selected{% endif %}>All</option>
                                <option value="Male" {% if gender == 'Male' %}selected{% endif %}>Male</option>
                                <option value="Female" {% if gender == 'Female' %}selected{% endif %}>Female</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-search"></i> Apply Filters
                    </button>
                </form>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="row mb-4">
            <div class="col-lg-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Concern Level Distribution</h5>
                    </div>
                    <div class="card-body text-center">
                        <img src="data:image/png;base64,{{ concern_plot }}" alt="Concern Distribution" class="img-fluid">
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-star"></i> Global Feature Importances</h5>
                    </div>
                    <div class="card-body text-center">
                        <img src="data:image/png;base64,{{ importances_plot }}" alt="Feature Importances" class="img-fluid">
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Preview -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-table"></i> Data Preview</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    {{ data_head | safe }}
                </div>
            </div>
        </div>

        <!-- Prediction Form -->
        <div class="card shadow-lg mb-5">
            <div class="card-header bg-gradient-success text-white">
                <h5 class="mb-0"><i class="fas fa-brain"></i> Predict Concern Level</h5>
            </div>
            <div class="card-body">
                <form action="/predict" method="POST">
                    <div class="row">
                        <div class="col-md-6 col-lg-4 mb-3">
                            <label for="age" class="form-label">
                                <i class="fas fa-birthday-cake"></i> Age *
                            </label>
                            <input type="number" id="age" name="age" min="13" max="18" 
                                   required class="form-control" placeholder="Enter age (13-18)">
                        </div>
                        <div class="col-md-6 col-lg-4 mb-3">
                            <label for="gender_predict" class="form-label">
                                <i class="fas fa-user"></i> Gender *
                            </label>
                            <select id="gender_predict" name="gender" required class="form-control">
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="col-md-6 col-lg-4 mb-3">
                            <label for="parental_education" class="form-label">
                                <i class="fas fa-graduation-cap"></i> Parental Education
                            </label>
                            <select id="parental_education" name="parental_education" class="form-control">
                                <option value="High School">High School</option>
                                <option value="Bachelor" selected>Bachelor</option>
                                <option value="Master">Master</option>
                                <option value="PhD">PhD</option>
                            </select>
                        </div>
                        <div class="col-md-6 col-lg-4 mb-3">
                            <label for="ad_exposure_freq" class="form-label">
                                <i class="fas fa-tv"></i> Ad Exposure Frequency
                            </label>
                            <select id="ad_exposure_freq" name="ad_exposure_freq" class="form-control">
                                <option value="Low">Low</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>
                        <div class="col-md-6 col-lg-4 mb-3">
                            <label for="health_knowledge" class="form-label">
                                <i class="fas fa-book-medical"></i> Health Knowledge
                            </label>
                            <select id="health_knowledge" name="health_knowledge" class="form-control">
                                <option value="Low">Low</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>
                        <div class="col-md-6 col-lg-4 mb-3">
                            <label for="parental_influence" class="form-label">
                                <i class="fas fa-hands-helping"></i> Parental Influence
                            </label>
                            <select id="parental_influence" name="parental_influence" class="form-control">
                                <option value="Low">Low</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <h6 class="mt-3 mb-3"><i class="fas fa-bullhorn"></i> Advertisement Types</h6>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="ad_type_celebrity" 
                                       name="ad_type_celebrity" value="1">
                                <label class="custom-control-label" for="ad_type_celebrity">
                                    <i class="fas fa-star"></i> Celebrity Endorsement
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="ad_type_free_toys" 
                                       name="ad_type_free_toys" value="1">
                                <label class="custom-control-label" for="ad_type_free_toys">
                                    <i class="fas fa-gift"></i> Free Toys/Gifts
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="ad_type_cartoon" 
                                       name="ad_type_cartoon" value="1">
                                <label class="custom-control-label" for="ad_type_cartoon">
                                    <i class="fas fa-smile-beam"></i> Cartoon Characters
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-success btn-lg px-5">
                            <i class="fas fa-magic"></i> Generate Prediction
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-5 py-4 bg-dark text-white">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 Adolescent Health Analytics. Powered by Machine Learning.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Convert checkboxes to proper values
        document.querySelector('form[action="/predict"]').addEventListener('submit', function(e) {
            ['ad_type_celebrity', 'ad_type_free_toys', 'ad_type_cartoon'].forEach(function(id) {
                var checkbox = document.getElementById(id);
                if (!checkbox.checked) {
                    var hidden = document.createElement('input');
                    hidden.type = 'hidden';
                    hidden.name = id;
                    hidden.value = '0';
                    this.appendChild(hidden);
                }
            }, this);
        });
    </script>
</body>
</html>